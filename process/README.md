# Обработка видео

### Этапы

0. ``src/env.py`` - задать вручную глобальные переменные.
1. ``python3 src/face_detector.py`` - чтение кадров из видео, детекция лиц и создание
эмбедингов. 
2. ``python3 src/cluster_faces.py`` - пред-обработка лиц, кластеризация и 
пост-обработка кластеров

### Алгоритмы

1. Детекция:
    - [pytorc_mtcnn](https://github.com/Seanlinx/mtcnn), на уровне 20-25 FPS,
    наивысшая точность. Предпочтительный алгоритм
    - **dlib cnn detecotor**, на уровне 30 FPS, точность ниже.
    - [mobilenet_ssd](https://github.com/yeephycho/tensorflow-face-detection)
    на уровне 60-80 FPS, неточная детекция, слишком большие кропы

2. Внутреннее представление лиц:
    - **dlib resnet face recognition (+ shape predictor)**, точность достаточно
    хорошая, показывает себя хуже при неполном лице, размытом изображении
    
3. Пред-обработка лица:
    - выбрать лица выше порога по ширине и высоте
    - выбрать фронтальные лица (5 точек mtcnn)
    - удалить лица с слишком большой или маленькой дисперсией по лапласиану

4. Кластеризация:
    - наилучший варианта **dlib.chinese_whispers** с порогом 0.45.
    - запасной вариант **иерархическая кластеризация** с предложенным порогом
    0.6 от авторов dlib.
    
5. Пост-обработка:
    - выбрать кластеры с высоким **silhouette score** (шум)
    - отсечь кластеры с кол-вом членов менее порога (шум)
    - отсечь кластеры с длительностью  меньше порога (прохожие)
    - отсечь кластера с частотой выше порога (работники)